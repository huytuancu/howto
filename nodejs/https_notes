# colloect important notes for setting basic node.js https server

How HTTPS Works
  Client initiates a secure connection to the server
  Server presents its SSL/TLS certificate to the client
  Client verifies the certificate with a trusted Certificate Authority (CA)
  Encrypted session is established using asymmetric encryption
  Symmetric encryption is used for the actual data transfer

Note: Modern HTTPS uses TLS (Transport Layer Security), which is the successor to SSL (Secure Sockets Layer). The terms are often used interchangeably, but SSL is now considered deprecated.

// Using require()
const https = require('https');

// Using import (requires "type": "module" in package.json) | Node.js version 14+
import https from 'https';

Note: The main difference in usage is that HTTPS requires SSL/TLS certificates, while HTTP does not.

Types of Certificates
  Self-Signed Certificates: For development and testing (not trusted by browsers) | for test
  Domain Validated (DV): Basic validation, just verifies domain ownership
  Organization Validated (OV): Validates organization details  | for production
  Extended Validation (EV): Highest level of validation, shows company name in browser
  Wildcard Certificates: Secures all subdomains of a domain | for production
  Multi-Domain (SAN) Certificates: Secures multiple domains with one certificate | for production

// For development, you can create self-signed certificates using OpenSSL:
# Generate a private key (RSA 2048-bit)
openssl genrsa -out key.pem 2048

# Generate a self-signed certificate (valid for 365 days)
openssl req -new -x509 -key key.pem -out cert.pem -days 365 -nodes

// Multi-Domain (SAN) Certificates | Subject Alternative Names:
# Create a config file (san.cnf)
cat > san.cnf << EOF
[req]
distinguished_name = req_distinguished_name
x509_extensions = v3_req
prompt = no
[req_distinguished_name]
C = US
ST = State
L = City
O = Organization
OU = Organizational Unit
CN = localhost
[v3_req]
keyUsage = keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names
[alt_names]
DNS.1 = localhost
IP.1 = 127.0.0.1
EOF

# Generate key and certificate with SAN
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout key.pem -out cert.pem -config san.cnf -extensions 'v3_req'

Các tổ chức cấp chứng chỉ CA trả phí : DigiCert, GlobalSign, Comodo, v.v.
Các tổ chức cấp chứng chỉ miễn phí : Let's Encrypt, ZeroSSL, Cloudflare

// .env file
NODE_ENV=development PORT=3000
HOST=0.0.0.0
SSL_KEY_PATH=./key.pem
SSL_CERT_PATH=./cert.pem

# Check if server supports HTTP/2
curl -I --http2 https://localhost:8443

# Force HTTP/2 with verbose output
curl -v --http2 https://localhost:8443

# Test with HTTP/2 prior knowledge (no upgrade)
curl --http2-prior-knowledge -I https://localhost:8443


Những điểm chính cần ghi nhớ
HTTPS là điều thiết yếu : Phát triển web hiện đại đòi hỏi HTTPS để đảm bảo an toàn dữ liệu, bảo vệ quyền riêng tư người dùng và tuân thủ các tiêu chuẩn web.
Quản lý chứng chỉ : Quản lý đúng cách các chứng chỉ SSL/TLS, cho dù sử dụng chứng chỉ tự ký cho môi trường phát triển hay chứng chỉ đáng tin cậy từ các tổ chức cấp chứng chỉ (CA) cho môi trường sản xuất.
Bảo mật là trên hết : Luôn luôn áp dụng các biện pháp bảo mật tốt nhất, bao gồm cấu hình TLS đúng cách, tiêu đề bảo mật và xác thực dữ liệu đầu vào.
Hiệu năng là yếu tố quan trọng : Tận dụng HTTP/2 để cải thiện hiệu năng thông qua các tính năng như ghép kênh, nén tiêu đề và đẩy dữ liệu từ máy chủ.
Chuẩn bị cho môi trường sản xuất : Sử dụng máy chủ proxy ngược (như Nginx) trong môi trường sản xuất để đảm bảo an ninh, hiệu năng và độ tin cậy tốt hơn.
